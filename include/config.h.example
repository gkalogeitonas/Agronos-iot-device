#pragma once

#include "sensor.h" // SensorConfig is defined in the sensor API header

// Network / server
constexpr const char* BASE_URL       = "https://agronos.kalogeitonas.xyz";
constexpr const char* DEFAULT_UUID   = "Test-Device-1";
constexpr const char* DEFAULT_SECRET = "Test-Device-1";

// Captive portal AP
constexpr const char* AP_SSID = "ESP_Config";
constexpr const char* AP_PASS = ""; // optional

// Button configuration
constexpr unsigned long BUTTON_LONG_PRESS_MS = 10000; // 10 seconds to trigger reset

constexpr int BUTTON_PIN = 14;

// DHT sensor
constexpr int DHT11_PIN = 21;

// non-blocking read interval
constexpr unsigned long SENSORS_READ_INTERVAL_MS = 2 * 60 * 1000; // 2 minute

// Auth manager
constexpr unsigned long AUTH_RETRY_INTERVAL_MS = 30000;


// ==================== MQTT CONFIGURATION ====================
// Enable/Disable MQTT protocol (set to false to use HTTP only)
constexpr bool MQTT_ENABLED = true;

// MQTT connection settings
constexpr uint16_t AGRONOS_MQTT_PORT = 1883;              // 8883 for TLS, 1883 for plain
constexpr bool AGRONOS_MQTT_USE_TLS = false;              // Use secure connection
constexpr uint16_t AGRONOS_MQTT_KEEPALIVE = 60;          // Keep-alive interval (seconds)
constexpr uint16_t AGRONOS_MQTT_RECONNECT_DELAY = 5000;  // Reconnection delay (ms)
constexpr bool AGRONOS_MQTT_CLEAN_SESSION = true;        // Start with clean session

// MQTT topics (will be formatted with device UUID)
// Use topics matching broker ACL: devices/<username>/# so EMQX allows publishes
constexpr const char* AGRONOS_MQTT_TOPIC_DATA = "devices/%s/sensors";
constexpr const char* AGRONOS_MQTT_TOPIC_STATUS = "devices/%s/status";
constexpr const char* AGRONOS_MQTT_TOPIC_COMMAND = "devices/%s/commands";

// MQTT QoS levels
constexpr int AGRONOS_MQTT_QOS_DATA = 1;      // At least once for sensor data
constexpr int AGRONOS_MQTT_QOS_STATUS = 0;    // Fire and forget for status

// NOTE: MQTT server, username, and password are fetched dynamically 
// from the backend using the JWT token after HTTP authentication.
// ============================================================


// Define sensors here only. To add/remove sensors modify this array.
// Use distinct types for temperature vs humidity for DHT11 as requested.
// For DHT20 (I2C), the pin parameter is ignored but should be provided (e.g., -1).
constexpr SensorConfig SENSOR_CONFIGS[] = {
    { "DHT11TemperatureReader", 21, "Test-Device-1-Sensor-1", "Temperature" },
    { "DHT11HumidityReader", 21, "Test-Device-1-Sensor-2", "Humidity" },
    { "SoilMoistureSensor", 32, "Soil-Moisture-1", "Soil Moisture" },
    { "DHT20TemperatureReader", -1, "DHT20-Temp-1", "DHT20 Temperature" },
    { "DHT20HumidityReader", -1, "DHT20-Hum-1", "DHT20 Humidity" }
};
constexpr size_t SENSOR_CONFIG_COUNT = sizeof(SENSOR_CONFIGS) / sizeof(SENSOR_CONFIGS[0]);

// Soil moisture sensor calibration (SEN0193)
constexpr int SOIL_MOISTURE_AIR_VALUE = 2941;    // Dry
constexpr int SOIL_MOISTURE_WATER_VALUE = 1324;  // Wet
